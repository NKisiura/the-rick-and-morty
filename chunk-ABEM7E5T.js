import{a as at}from"./chunk-OPXSG5Y2.js";import"./chunk-XDWRJOZU.js";import{a as X,b as q,f as Y,g as Z,h as $,i as tt,j as et,k as it,l as nt,m as ot}from"./chunk-XOLOHFGZ.js";import"./chunk-6RRLMYQ5.js";import"./chunk-BUYXJ4OI.js";import{b as G,d as H,e as J,n as K}from"./chunk-NEX2WLXG.js";import"./chunk-NIWLSCTU.js";import{$b as B,Aa as w,Ba as k,Bb as j,Cb as N,Db as l,Eb as s,Fb as P,Ha as V,Ia as v,J as O,Jb as R,Nb as h,Ob as m,Zb as F,_ as M,aa as f,bc as D,cc as I,dc as E,eb as r,ec as U,fa as Q,fc as _,hc as z,la as C,pa as x,qa as L,u as y,ub as b,wb as u,zb as S}from"./chunk-4ZLDDYG2.js";import{a as p,b as g,c as T}from"./chunk-55KE2TB7.js";var st={initialFilter:{},filter:{},isLoading:!1,locations:null,paginationInfo:null,error:null},W=(()=>{let i=class i extends X{constructor(){super(st),this.locationsApiService=C(at),this.activatedRoute=C(G),this.router=C(H),this.locations=this.selectSignal(({locations:e})=>e),this.locationsLoading=this.selectSignal(({isLoading:e})=>e),this.hasLoadedLocations=this.selectSignal(({locations:e})=>!!e),this.error=this.selectSignal(({error:e})=>e),this.initialFilter=this.selectSignal(({initialFilter:e})=>e),this.locationsFilter=this.selectSignal(({filter:e})=>e),this.currentPage=this.selectSignal(this.locationsFilter,({page:e})=>e||1),this.pagesCount=this.selectSignal(({paginationInfo:e})=>e?.pages||1),this.isLastPage=this.selectSignal(this.pagesCount,this.currentPage,(e,t)=>e===t),this.initialLocationsRequested=this.effect(e=>e.pipe(y(()=>this.initialFilter()),f(t=>{this.patchState({filter:t}),this.applyFilterToQueryParams(t),this.locationByFilterRequested(t)}))),this.filterChanged=this.effect(e=>e.pipe(O(300),y(t=>g(p({},t),{page:1})),f(t=>{this.patchState({filter:t,locations:null}),this.applyFilterToQueryParams(t),this.locationByFilterRequested(t)}))),this.pageChanged=this.effect(e=>e.pipe(y(t=>g(p({},this.locationsFilter()),{page:t})),f(t=>{this.patchState({filter:t,locations:null}),this.applyFilterToQueryParams(t),this.locationByFilterRequested(t)}))),this.locationByFilterRequested=this.effect(e=>e.pipe(f(()=>this.patchState({isLoading:!0})),M(t=>this.locationsApiService.getLocationsByFilter(t).pipe(q(n=>{this.locationByFilterSucceeded(n)},({error:n})=>{this.locationByFilterFailed(n)}))))),this.nextPageRequested=this.effect(e=>e.pipe(y(()=>{let c=this.locationsFilter(),{page:t}=c,n=T(c,["page"]);return g(p({},n),{page:(t||1)+1})}),f(t=>{this.patchState({filter:t,isLoading:!0}),this.applyFilterToQueryParams(t)}),M(t=>this.locationsApiService.getLocationsByFilter(t).pipe(q(n=>{this.nextPageSucceeded(n)},({error:n})=>{this.nextPageFailed(n)}))))),this.locationByFilterSucceeded=this.updater((e,{info:t,results:n})=>g(p({},e),{isLoading:!1,locations:n,paginationInfo:t,error:null})),this.locationByFilterFailed=this.updater((e,t)=>g(p({},e),{isLoading:!1,locations:null,paginationInfo:null,error:t})),this.nextPageSucceeded=this.updater((e,{info:t,results:n})=>g(p({},e),{isLoading:!1,locations:[...e.locations||[],...n],paginationInfo:t,error:null})),this.nextPageFailed=this.updater((e,t)=>g(p({},e),{isLoading:!1,error:t})),this.pathStateWithInitialFilterFromQueryParams()}pathStateWithInitialFilterFromQueryParams(){let c=this.activatedRoute.snapshot.queryParams,{page:e}=c,t=T(c,["page"]),n=p({page:+e||1},t);this.patchState({initialFilter:n})}applyFilterToQueryParams(e){this.router.navigate([],{queryParams:e})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=Q({token:i,factory:i.\u0275fac});let o=i;return o})();var ct=(o,i)=>[o,i],rt=(()=>{let i=class i{constructor(){this.APP_ROUTES=K,this.location=v.required()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=L({type:i,selectors:[["location-card"]],inputs:{location:[x.SignalBased,"location"]},standalone:!0,features:[_],decls:6,vars:7,consts:[[1,"flex","h-full","flex-col","items-center","overflow-hidden","rounded-xl","bg-blue/10","font-primary","text-primary"],[1,"w-full","bg-blue/65","px-4","py-3","text-center","capitalize"],[1,"flex","justify-center","px-4","py-3"],[1,"text-center","text-lg","underline","decoration-blue","underline-offset-4","transition-colors","hover:text-accent",3,"routerLink","relativeTo"]],template:function(t,n){t&1&&(l(0,"div",0)(1,"div",1),F(2),s(),l(3,"div",2)(4,"a",3),F(5),s()()()),t&2&&(r(2),B(" ",n.location().type||"unknown"," "),r(2),u("routerLink",z(4,ct,n.APP_ROUTES.LOCATIONS,n.location().id))("relativeTo",null),r(),B(" ",n.location().name," "))},dependencies:[J],changeDetection:0});let o=i;return o})();var lt=(()=>{let i=class i{constructor(){this.initialFilter=v({}),this.filterChange=V(),this.filter={}}ngOnInit(){this.filter=this.initialFilter()}handleFilterChange(){this.filterChange.emit(p({},this.filter))}clearFilter(){this.filter={},this.handleFilterChange()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=L({type:i,selectors:[["locations-filter"]],inputs:{initialFilter:[x.SignalBased,"initialFilter"]},outputs:{filterChange:"filterChange"},standalone:!0,features:[_],decls:5,vars:2,consts:[[1,"grid","grid-cols-2","gap-4","sm:grid-cols-3","lg:grid-cols-4","xl:grid-cols-5","2xl:grid-cols-6"],["type","text","placeholder","Name",1,"col-span-2","rounded-lg","border","border-blue","bg-dark-blue","px-4","py-1.5","font-primary","text-accent","outline-0","transition-colors","placeholder:font-light","placeholder:text-blue","focus:border-accent","sm:col-span-1",3,"ngModelChange","input","ngModel"],["type","text","placeholder","Type",1,"rounded-lg","border","border-blue","bg-dark-blue","px-4","py-1.5","font-primary","text-accent","outline-0","transition-colors","placeholder:font-light","placeholder:text-blue","focus:border-accent",3,"ngModelChange","input","ngModel"],["type","button",1,"rounded-lg","border","border-accent","bg-dark-blue","font-primary","font-medium","text-accent","transition-colors","hover:bg-accent","hover:text-dark-blue","lg:!col-span-1",3,"click"]],template:function(t,n){t&1&&(l(0,"div",0)(1,"input",1),E("ngModelChange",function(d){return I(n.filter.name,d)||(n.filter.name=d),d}),h("input",function(){return n.handleFilterChange()}),s(),l(2,"input",2),E("ngModelChange",function(d){return I(n.filter.type,d)||(n.filter.type=d),d}),h("input",function(){return n.handleFilterChange()}),s(),l(3,"button",3),h("click",function(){return n.clearFilter()}),F(4," Clear "),s()()),t&2&&(r(),D("ngModel",n.filter.name),r(),D("ngModel",n.filter.type))},dependencies:[tt,Y,Z,$],changeDetection:0});let o=i;return o})();var pt=(o,i)=>i.id;function dt(o,i){if(o&1&&P(0,"location-card",7),o&2){let a=i.$implicit;u("location",a)}}function gt(o,i){if(o&1){let a=R();l(0,"load-more-button",11),h("click",function(){w(a);let t=m(2);return k(t.handleShowMore())}),s()}if(o&2){let a=m(2);u("isLoading",a.locationsLoading())}}function ut(o,i){if(o&1){let a=R();l(0,"div",5)(1,"div",6),j(2,dt,1,1,"location-card",7,pt),s(),l(4,"div",8),b(5,gt,1,1,"load-more-button",9),l(6,"pagination",10),h("pageChange",function(t){w(a);let n=m();return k(n.handlePageChange(t))}),s()()()}if(o&2){let a=m();r(2),N(a.locations()),r(3),S(5,a.isLastPage()?-1:5),r(),u("page",a.currentPage())("pagesCount",a.pagesCount())("isDisabled",a.locationsLoading())}}function ht(o,i){o&1&&P(0,"loader")}function mt(o,i){if(o&1&&P(0,"error-message",12),o&2){let a=m(2);u("errorMessage",a.error().error)}}function ft(o,i){if(o&1&&b(0,ht,1,0,"loader")(1,mt,1,1,"error-message",12),o&2){let a=m();S(0,a.locationsLoading()?0:-1),r(),S(1,a.error()&&!a.locationsLoading()?1:-1)}}var Jt=(()=>{let i=class i{constructor(){this.locationListStore=C(W),this.locations=this.locationListStore.locations,this.locationsLoading=this.locationListStore.locationsLoading,this.hasLoadedLocations=this.locationListStore.hasLoadedLocations,this.error=this.locationListStore.error,this.initialFilter=this.locationListStore.initialFilter,this.currentPage=this.locationListStore.currentPage,this.pagesCount=this.locationListStore.pagesCount,this.isLastPage=this.locationListStore.isLastPage}ngOnInit(){this.locationListStore.initialLocationsRequested()}handleShowMore(){this.locationListStore.nextPageRequested()}handlePageChange(e){this.locationListStore.pageChanged(e)}handleFilterChange(e){this.locationListStore.filterChanged(e)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=L({type:i,selectors:[["app-location-list"]],standalone:!0,features:[U([W]),_],decls:8,vars:2,consts:[[1,"pb-4","lg:pb-6"],[1,"sticky","top-header-height","bg-app-background","bg-app-background-pattern","pb-4","pt-2","lg:pb-6"],[1,"container"],[1,"rounded-xl","bg-light-blue/10","p-4"],[3,"filterChange","initialFilter"],[1,"flex","flex-col","gap-4","lg:gap-6"],[1,"grid","grid-cols-1","gap-4","sm:grid-cols-2","lg:grid-cols-3","lg:gap-6","2xl:grid-cols-4"],[3,"location"],[1,"flex","flex-col","items-center","gap-4","lg:gap-6"],[3,"isLoading"],[3,"pageChange","page","pagesCount","isDisabled"],[3,"click","isLoading"],[3,"errorMessage"]],template:function(t,n){t&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"locations-filter",4),h("filterChange",function(d){return n.handleFilterChange(d)}),s()()()(),l(5,"div",2),b(6,ut,7,4,"div",5)(7,ft,2,2),s()()),t&2&&(r(4),u("initialFilter",n.initialFilter()),r(2),S(6,n.hasLoadedLocations()?6:7))},dependencies:[rt,lt,et,it,ot,nt],changeDetection:0});let o=i;return o})();export{Jt as LocationListPageComponent};
