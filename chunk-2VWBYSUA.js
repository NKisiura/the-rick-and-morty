import{a as V,b as A,d as j}from"./chunk-OD42XJDA.js";import"./chunk-XDWRJOZU.js";import"./chunk-COXDFDNR.js";import{a as E,b,j as W,k as $,l as O,m as z}from"./chunk-XOLOHFGZ.js";import"./chunk-6RRLMYQ5.js";import"./chunk-BUYXJ4OI.js";import{b as Q,d as D}from"./chunk-NEX2WLXG.js";import"./chunk-NIWLSCTU.js";import{Aa as x,Ba as y,Bb as q,Cb as I,Db as h,Eb as m,Fb as S,J as R,Jb as v,Nb as L,Ob as l,_ as P,aa as d,eb as c,ec as M,fa as B,fc as k,la as g,qa as w,u as C,ub as _,wb as u,zb as f}from"./chunk-4ZLDDYG2.js";import{a as s,b as o,c as F}from"./chunk-55KE2TB7.js";var J={initialFilter:{},filter:{},isLoading:!1,characters:null,paginationInfo:null,error:null},T=(()=>{let i=class i extends E{constructor(){super(J),this.charactersApiService=g(V),this.activatedRoute=g(Q),this.router=g(D),this.characters=this.selectSignal(({characters:e})=>e),this.charactersLoading=this.selectSignal(({isLoading:e})=>e),this.hasLoadedCharacters=this.selectSignal(({characters:e})=>!!e),this.error=this.selectSignal(({error:e})=>e),this.initialFilter=this.selectSignal(({initialFilter:e})=>e),this.charactersFilter=this.selectSignal(({filter:e})=>e),this.currentPage=this.selectSignal(this.charactersFilter,({page:e})=>e||1),this.pagesCount=this.selectSignal(({paginationInfo:e})=>e?.pages||1),this.isLastPage=this.selectSignal(this.pagesCount,this.currentPage,(e,t)=>e===t),this.initialCharactersRequested=this.effect(e=>e.pipe(C(()=>this.initialFilter()),d(t=>{this.patchState({filter:t}),this.applyFilterToQueryParams(t),this.charactersByFilterRequested(t)}))),this.filterChanged=this.effect(e=>e.pipe(R(300),C(t=>o(s({},t),{page:1})),d(t=>{this.patchState({filter:t,characters:null}),this.applyFilterToQueryParams(t),this.charactersByFilterRequested(t)}))),this.pageChanged=this.effect(e=>e.pipe(C(t=>o(s({},this.charactersFilter()),{page:t})),d(t=>{this.patchState({filter:t,characters:null}),this.applyFilterToQueryParams(t),this.charactersByFilterRequested(t)}))),this.charactersByFilterRequested=this.effect(e=>e.pipe(d(()=>this.patchState({isLoading:!0})),P(t=>this.charactersApiService.getCharactersByFilter(t).pipe(b(r=>{this.charactersByFilterSucceeded(r)},({error:r})=>{this.charactersByFilterFailed(r)}))))),this.nextPageRequested=this.effect(e=>e.pipe(C(()=>{let p=this.charactersFilter(),{page:t}=p,r=F(p,["page"]);return o(s({},r),{page:(t||1)+1})}),d(t=>{this.patchState({filter:t,isLoading:!0}),this.applyFilterToQueryParams(t)}),P(t=>this.charactersApiService.getCharactersByFilter(t).pipe(b(r=>{this.nextPageSucceeded(r)},({error:r})=>{this.nextPageFailed(r)}))))),this.charactersByFilterSucceeded=this.updater((e,{info:t,results:r})=>o(s({},e),{isLoading:!1,characters:r,paginationInfo:t,error:null})),this.charactersByFilterFailed=this.updater((e,t)=>o(s({},e),{isLoading:!1,characters:null,paginationInfo:null,error:t})),this.nextPageSucceeded=this.updater((e,{info:t,results:r})=>o(s({},e),{isLoading:!1,characters:[...e.characters||[],...r],paginationInfo:t,error:null})),this.nextPageFailed=this.updater((e,t)=>o(s({},e),{isLoading:!1,error:t})),this.pathStateWithInitialFilterFromQueryParams()}pathStateWithInitialFilterFromQueryParams(){let p=this.activatedRoute.snapshot.queryParams,{page:e}=p,t=F(p,["page"]),r=s({page:+e||1},t);this.patchState({initialFilter:r})}applyFilterToQueryParams(e){this.router.navigate([],{queryParams:e})}};i.\u0275fac=function(t){return new(t||i)},i.\u0275prov=B({token:i,factory:i.\u0275fac});let a=i;return a})();var K=(a,i)=>i.id;function N(a,i){if(a&1&&S(0,"character-card",7),a&2){let n=i.$implicit;u("character",n)}}function U(a,i){if(a&1){let n=v();h(0,"load-more-button",11),L("click",function(){x(n);let t=l(2);return y(t.handleShowMore())}),m()}if(a&2){let n=l(2);u("isLoading",n.charactersLoading())}}function X(a,i){if(a&1){let n=v();h(0,"div",5)(1,"div",6),q(2,N,1,1,"character-card",7,K),m(),h(4,"div",8),_(5,U,1,1,"load-more-button",9),h(6,"pagination",10),L("pageChange",function(t){x(n);let r=l();return y(r.handlePageChange(t))}),m()()()}if(a&2){let n=l();c(2),I(n.characters()),c(3),f(5,n.isLastPage()?-1:5),c(),u("page",n.currentPage())("pagesCount",n.pagesCount())("isDisabled",n.charactersLoading())}}function Y(a,i){a&1&&S(0,"loader")}function Z(a,i){if(a&1&&S(0,"error-message",12),a&2){let n=l(2);u("errorMessage",n.error().error)}}function ee(a,i){if(a&1&&_(0,Y,1,0,"loader")(1,Z,1,1,"error-message",12),a&2){let n=l();f(0,n.charactersLoading()?0:-1),c(),f(1,n.error()&&!n.charactersLoading()?1:-1)}}var Ce=(()=>{let i=class i{constructor(){this.characterListStore=g(T),this.characters=this.characterListStore.characters,this.charactersLoading=this.characterListStore.charactersLoading,this.hasLoadedCharacters=this.characterListStore.hasLoadedCharacters,this.error=this.characterListStore.error,this.initialFilter=this.characterListStore.initialFilter,this.currentPage=this.characterListStore.currentPage,this.pagesCount=this.characterListStore.pagesCount,this.isLastPage=this.characterListStore.isLastPage}ngOnInit(){this.characterListStore.initialCharactersRequested()}handleShowMore(){this.characterListStore.nextPageRequested()}handlePageChange(e){this.characterListStore.pageChanged(e)}handleFilterChange(e){this.characterListStore.filterChanged(e)}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=w({type:i,selectors:[["app-character-list"]],standalone:!0,features:[M([T]),k],decls:8,vars:2,consts:[[1,"pb-4","lg:pb-6"],[1,"sticky","top-header-height","bg-app-background","bg-app-background-pattern","pb-4","pt-2","lg:pb-6"],[1,"container"],[1,"rounded-xl","bg-light-blue/10","p-4"],[3,"filterChange","initialFilter"],[1,"flex","flex-col","gap-4","lg:gap-6"],[1,"grid","grid-cols-1","gap-4","lg:grid-cols-2","lg:gap-6"],[3,"character"],[1,"flex","flex-col","items-center","gap-4","lg:gap-6"],[3,"isLoading"],[3,"pageChange","page","pagesCount","isDisabled"],[3,"click","isLoading"],[3,"errorMessage"]],template:function(t,r){t&1&&(h(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"characters-filter",4),L("filterChange",function(G){return r.handleFilterChange(G)}),m()()()(),h(5,"div",2),_(6,X,7,4,"div",5)(7,ee,2,2),m()()),t&2&&(c(4),u("initialFilter",r.initialFilter()),c(2),f(6,r.hasLoadedCharacters()?6:7))},dependencies:[A,j,W,$,O,z],changeDetection:0});let a=i;return a})();export{Ce as CharacterListPageComponent};
