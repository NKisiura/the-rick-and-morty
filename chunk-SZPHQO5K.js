import{a as z,b as O}from"./chunk-IJDNZOMX.js";import{a as $}from"./chunk-RJOGWNFP.js";import"./chunk-DNTDIB4D.js";import{a as D,b as E,p as V,q as A,r as j,s as W}from"./chunk-LETE22YY.js";import"./chunk-EUUAAR3L.js";import"./chunk-6KRU7EG5.js";import{b as k,d as Q}from"./chunk-66XNF6FV.js";import{Db as I,Eb as M,Ha as p,I as T,Va as _,Xa as u,Y as P,_ as h,_a as C,ab as w,bb as q,ca as R,cb as d,db as m,eb as S,ia as g,ib as v,kb as L,lb as l,ma as B,t as f,ua as x,va as y}from"./chunk-SN7ESOYK.js";import{a,b as r,c as F}from"./chunk-35PI25VP.js";var J={initialFilter:{},filter:{},isLoading:!1,episodes:null,paginationInfo:null,error:null},b=(()=>{let s=class s extends D{constructor(){super(J),this.episodesApiService=g($),this.activatedRoute=g(k),this.router=g(Q),this.episodes=this.selectSignal(({episodes:e})=>e),this.episodesLoading=this.selectSignal(({isLoading:e})=>e),this.hasLoadedEpisodes=this.selectSignal(({episodes:e})=>!!e),this.error=this.selectSignal(({error:e})=>e),this.initialFilter=this.selectSignal(({initialFilter:e})=>e),this.episodesFilter=this.selectSignal(({filter:e})=>e),this.currentPage=this.selectSignal(this.episodesFilter,({page:e})=>e||1),this.pagesCount=this.selectSignal(({paginationInfo:e})=>e?.pages||1),this.isLastPage=this.selectSignal(this.pagesCount,this.currentPage,(e,i)=>e===i),this.initialEpisodesRequested=this.effect(e=>e.pipe(f(()=>this.initialFilter()),h(i=>{this.patchState({filter:i}),this.applyFilterToQueryParams(i),this.episodesByFilterRequested(i)}))),this.filterChanged=this.effect(e=>e.pipe(T(300),f(i=>r(a({},i),{page:1})),h(i=>{this.patchState({filter:i,episodes:null}),this.applyFilterToQueryParams(i),this.episodesByFilterRequested(i)}))),this.pageChanged=this.effect(e=>e.pipe(f(i=>r(a({},this.episodesFilter()),{page:i})),h(i=>{this.patchState({filter:i,episodes:null}),this.applyFilterToQueryParams(i),this.episodesByFilterRequested(i)}))),this.episodesByFilterRequested=this.effect(e=>e.pipe(h(()=>this.patchState({isLoading:!0})),P(i=>this.episodesApiService.getEpisodesByFilter(i).pipe(E(o=>{this.episodesByFilterSucceeded(o)},({error:o})=>{this.episodesByFilterFailed(o)}))))),this.nextPageRequested=this.effect(e=>e.pipe(f(()=>{let c=this.episodesFilter(),{page:i}=c,o=F(c,["page"]);return r(a({},o),{page:(i||1)+1})}),h(i=>{this.patchState({filter:i,isLoading:!0}),this.applyFilterToQueryParams(i)}),P(i=>this.episodesApiService.getEpisodesByFilter(i).pipe(E(o=>{this.nextPageSucceeded(o)},({error:o})=>{this.nextPageFailed(o)}))))),this.episodesByFilterSucceeded=this.updater((e,{info:i,results:o})=>r(a({},e),{isLoading:!1,episodes:o,paginationInfo:i,error:null})),this.episodesByFilterFailed=this.updater((e,i)=>r(a({},e),{isLoading:!1,episodes:null,paginationInfo:null,error:i})),this.nextPageSucceeded=this.updater((e,{info:i,results:o})=>r(a({},e),{isLoading:!1,episodes:[...e.episodes||[],...o],paginationInfo:i,error:null})),this.nextPageFailed=this.updater((e,i)=>r(a({},e),{isLoading:!1,error:i})),this.pathStateWithInitialFilterFromQueryParams()}pathStateWithInitialFilterFromQueryParams(){let c=this.activatedRoute.snapshot.queryParams,{page:e}=c,i=F(c,["page"]),o=a({page:+e||1},i);this.patchState({initialFilter:o})}applyFilterToQueryParams(e){this.router.navigate([],{queryParams:e})}};s.\u0275fac=function(i){return new(i||s)},s.\u0275prov=R({token:s,factory:s.\u0275fac});let t=s;return t})();var K=(t,s)=>s.id;function N(t,s){if(t&1&&S(0,"episode-card",7),t&2){let n=s.$implicit;u("episode",n)}}function U(t,s){if(t&1){let n=v();d(0,"load-more-button",11),L("click",function(){x(n);let i=l(2);return y(i.handleShowMore())}),m()}if(t&2){let n=l(2);u("isLoading",n.episodesLoading())}}function X(t,s){if(t&1){let n=v();d(0,"div",5)(1,"div",6),w(2,N,1,1,"episode-card",7,K),m(),d(4,"div",8),_(5,U,1,1,"load-more-button",9),d(6,"pagination",10),L("pageChange",function(i){x(n);let o=l();return y(o.handlePageChange(i))}),m()()()}if(t&2){let n=l();p(2),q(n.episodes()),p(3),C(5,n.isLastPage()?-1:5),p(),u("page",n.currentPage())("pagesCount",n.pagesCount())("isDisabled",n.episodesLoading())}}function Y(t,s){t&1&&S(0,"loader")}function Z(t,s){if(t&1&&S(0,"error-message",12),t&2){let n=l(2);u("errorMessage",n.error().error)}}function ee(t,s){if(t&1&&_(0,Y,1,0,"loader")(1,Z,1,1,"error-message",12),t&2){let n=l();C(0,n.episodesLoading()?0:-1),p(),C(1,n.error()&&!n.episodesLoading()?1:-1)}}var fe=(()=>{let s=class s{constructor(){this.episodesListStore=g(b),this.episodes=this.episodesListStore.episodes,this.episodesLoading=this.episodesListStore.episodesLoading,this.hasLoadedEpisodes=this.episodesListStore.hasLoadedEpisodes,this.error=this.episodesListStore.error,this.initialFilter=this.episodesListStore.initialFilter,this.currentPage=this.episodesListStore.currentPage,this.pagesCount=this.episodesListStore.pagesCount,this.isLastPage=this.episodesListStore.isLastPage}ngOnInit(){this.episodesListStore.initialEpisodesRequested()}handleShowMore(){this.episodesListStore.nextPageRequested()}handlePageChange(e){this.episodesListStore.pageChanged(e)}handleFilterChange(e){this.episodesListStore.filterChanged(e)}};s.\u0275fac=function(i){return new(i||s)},s.\u0275cmp=B({type:s,selectors:[["ng-component"]],standalone:!0,features:[I([b]),M],decls:8,vars:2,consts:[[1,"pb-4","lg:pb-6"],[1,"sticky","top-header-height","z-10","bg-app-background","bg-app-background-pattern","pb-4","pt-2","lg:pb-6"],[1,"container"],[1,"rounded-xl","bg-light-blue/10","p-4"],[3,"filterChange","initialFilter"],[1,"flex","flex-col","gap-4","lg:gap-6"],[1,"grid","grid-cols-1","gap-4","sm:grid-cols-2","lg:grid-cols-3","lg:gap-6","2xl:grid-cols-4"],[3,"episode"],[1,"flex","flex-col","items-center","gap-4","lg:gap-6"],[3,"isLoading"],[3,"pageChange","page","pagesCount","isDisabled"],[3,"click","isLoading"],[3,"errorMessage"]],template:function(i,o){i&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"episodes-filter",4),L("filterChange",function(G){return o.handleFilterChange(G)}),m()()()(),d(5,"div",2),_(6,X,7,4,"div",5)(7,ee,2,2),m()()),i&2&&(p(4),u("initialFilter",o.initialFilter()),p(2),C(6,o.hasLoadedEpisodes()?6:7))},dependencies:[z,O,V,j,W,A],changeDetection:0});let t=s;return t})();export{fe as EpisodeListPageComponent};
