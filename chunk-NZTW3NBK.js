import{a as z,b as O}from"./chunk-SDCNU222.js";import{a as $}from"./chunk-72HK74FD.js";import"./chunk-OLQBKCZU.js";import{a as E,b,p as V,q as A,r as j,s as W}from"./chunk-N77CJIUJ.js";import"./chunk-VZYJC24G.js";import"./chunk-SELDRIOR.js";import{b as Q,d as D}from"./chunk-DUXSHKKQ.js";import{Gb as M,Hb as k,J as R,Ka as l,Ya as C,_ as P,_a as u,aa as h,bb as f,db as q,ea as B,eb as I,fb as c,gb as m,hb as _,ka as g,lb as v,nb as S,oa as w,ob as p,u as L,wa as x,xa as y}from"./chunk-7XFWTFYN.js";import{a as s,b as r,c as F}from"./chunk-35PI25VP.js";var J={initialFilter:{},filter:{},isLoading:!1,locations:null,paginationInfo:null,error:null},T=(()=>{let o=class o extends E{constructor(){super(J),this.locationsApiService=g($),this.activatedRoute=g(Q),this.router=g(D),this.locations=this.selectSignal(({locations:t})=>t),this.locationsLoading=this.selectSignal(({isLoading:t})=>t),this.hasLoadedLocations=this.selectSignal(({locations:t})=>!!t),this.error=this.selectSignal(({error:t})=>t),this.initialFilter=this.selectSignal(({initialFilter:t})=>t),this.locationsFilter=this.selectSignal(({filter:t})=>t),this.currentPage=this.selectSignal(this.locationsFilter,({page:t})=>t||1),this.pagesCount=this.selectSignal(({paginationInfo:t})=>t?.pages||1),this.isLastPage=this.selectSignal(this.pagesCount,this.currentPage,(t,e)=>t===e),this.initialLocationsRequested=this.effect(t=>t.pipe(L(()=>this.initialFilter()),h(e=>{this.patchState({filter:e}),this.applyFilterToQueryParams(e),this.locationByFilterRequested(e)}))),this.filterChanged=this.effect(t=>t.pipe(R(300),L(e=>r(s({},e),{page:1})),h(e=>{this.patchState({filter:e,locations:null}),this.applyFilterToQueryParams(e),this.locationByFilterRequested(e)}))),this.pageChanged=this.effect(t=>t.pipe(L(e=>r(s({},this.locationsFilter()),{page:e})),h(e=>{this.patchState({filter:e,locations:null}),this.applyFilterToQueryParams(e),this.locationByFilterRequested(e)}))),this.locationByFilterRequested=this.effect(t=>t.pipe(h(()=>this.patchState({isLoading:!0})),P(e=>this.locationsApiService.getLocationsByFilter(e).pipe(b(n=>{this.locationByFilterSucceeded(n)},({error:n})=>{this.locationByFilterFailed(n)}))))),this.nextPageRequested=this.effect(t=>t.pipe(L(()=>{let d=this.locationsFilter(),{page:e}=d,n=F(d,["page"]);return r(s({},n),{page:(e||1)+1})}),h(e=>{this.patchState({filter:e,isLoading:!0}),this.applyFilterToQueryParams(e)}),P(e=>this.locationsApiService.getLocationsByFilter(e).pipe(b(n=>{this.nextPageSucceeded(n)},({error:n})=>{this.nextPageFailed(n)}))))),this.locationByFilterSucceeded=this.updater((t,{info:e,results:n})=>r(s({},t),{isLoading:!1,locations:n,paginationInfo:e,error:null})),this.locationByFilterFailed=this.updater((t,e)=>r(s({},t),{isLoading:!1,locations:null,paginationInfo:null,error:e})),this.nextPageSucceeded=this.updater((t,{info:e,results:n})=>r(s({},t),{isLoading:!1,locations:[...t.locations||[],...n],paginationInfo:e,error:null})),this.nextPageFailed=this.updater((t,e)=>r(s({},t),{isLoading:!1,error:e})),this.pathStateWithInitialFilterFromQueryParams()}pathStateWithInitialFilterFromQueryParams(){let d=this.activatedRoute.snapshot.queryParams,{page:t}=d,e=F(d,["page"]),n=s({page:+t||1},e);this.patchState({initialFilter:n})}applyFilterToQueryParams(t){this.router.navigate([],{queryParams:t})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=B({token:o,factory:o.\u0275fac});let i=o;return i})();var K=(i,o)=>o.id;function N(i,o){if(i&1&&_(0,"location-card",7),i&2){let a=o.$implicit;u("location",a)}}function U(i,o){if(i&1){let a=v();c(0,"load-more-button",11),S("click",function(){x(a);let e=p(2);return y(e.handleShowMore())}),m()}if(i&2){let a=p(2);u("isLoading",a.locationsLoading())}}function X(i,o){if(i&1){let a=v();c(0,"div",5)(1,"div",6),q(2,N,1,1,"location-card",7,K),m(),c(4,"div",8),C(5,U,1,1,"load-more-button",9),c(6,"pagination",10),S("pageChange",function(e){x(a);let n=p();return y(n.handlePageChange(e))}),m()()()}if(i&2){let a=p();l(2),I(a.locations()),l(3),f(5,a.isLastPage()?-1:5),l(),u("page",a.currentPage())("pagesCount",a.pagesCount())("isDisabled",a.locationsLoading())}}function Y(i,o){i&1&&_(0,"loader")}function Z(i,o){if(i&1&&_(0,"error-message",12),i&2){let a=p(2);u("errorMessage",a.error().error)}}function tt(i,o){if(i&1&&C(0,Y,1,0,"loader")(1,Z,1,1,"error-message",12),i&2){let a=p();f(0,a.locationsLoading()?0:-1),l(),f(1,a.error()&&!a.locationsLoading()?1:-1)}}var Lt=(()=>{let o=class o{constructor(){this.locationListStore=g(T),this.locations=this.locationListStore.locations,this.locationsLoading=this.locationListStore.locationsLoading,this.hasLoadedLocations=this.locationListStore.hasLoadedLocations,this.error=this.locationListStore.error,this.initialFilter=this.locationListStore.initialFilter,this.currentPage=this.locationListStore.currentPage,this.pagesCount=this.locationListStore.pagesCount,this.isLastPage=this.locationListStore.isLastPage}ngOnInit(){this.locationListStore.initialLocationsRequested()}handleShowMore(){this.locationListStore.nextPageRequested()}handlePageChange(t){this.locationListStore.pageChanged(t)}handleFilterChange(t){this.locationListStore.filterChanged(t)}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=w({type:o,selectors:[["ng-component"]],standalone:!0,features:[M([T]),k],decls:8,vars:2,consts:[[1,"pb-4","lg:pb-6"],[1,"sticky","top-header-height","z-10","bg-app-background","bg-app-background-pattern","pb-4","pt-2","lg:pb-6"],[1,"container"],[1,"rounded-xl","bg-light-blue/10","p-4"],[3,"filterChange","initialFilter"],[1,"flex","flex-col","gap-4","lg:gap-6"],[1,"grid","grid-cols-1","gap-4","sm:grid-cols-2","lg:grid-cols-3","lg:gap-6","2xl:grid-cols-4"],[3,"location"],[1,"flex","flex-col","items-center","gap-4","lg:gap-6"],[3,"isLoading"],[3,"pageChange","page","pagesCount","isDisabled"],[3,"click","isLoading"],[3,"errorMessage"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"locations-filter",4),S("filterChange",function(G){return n.handleFilterChange(G)}),m()()()(),c(5,"div",2),C(6,X,7,4,"div",5)(7,tt,2,2),m()()),e&2&&(l(4),u("initialFilter",n.initialFilter()),l(2),f(6,n.hasLoadedLocations()?6:7))},dependencies:[z,O,V,A,W,j],changeDetection:0});let i=o;return i})();export{Lt as LocationListPageComponent};
